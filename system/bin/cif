#!/bin/bash

# Open interactive preview for opening files in vim

set -euo pipefail

ROOT=$(pwd)
FZF_DEFAULT_COMMAND='rg --files --hidden'
if [[ $# -gt 0 ]]; then
    ROOT=$1
    FZF_DEFAULT_COMMAND="$FZF_DEFAULT_COMMAND $ROOT"
fi

TARGET=$(fzf --preview 'bat --force-colorization --plain {}')
#open vscode://file/$TARGET
# Problem: Mac OS doesn't have realpath / readlink installed by default :(
if [[ "${TARGET::1}" == '~' ]]; then
    # This apparently doesn't happen because as soon as we evaluate here, the tilde is replaced
    echo replacing tilde
    TARGET=${TARGET/~/$HOME}
elif [[ "${TARGET::1}" != "/" ]]; then
    # relative path
    TARGET=$(pwd)/$TARGET
fi

code "$TARGET"
